<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Crossword Editor - Inbox Puzzles</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
:root{
  --teal:#1f9dbf;
  --gold:#f5b041;
  --gray:#ddd;
  --bg:#fafafa;
}
body{
  margin:0;
  font-family:Arial,Helvetica,sans-serif;
  background:var(--bg);
  color:#222;
}
.wrapper{
  max-width:1100px;
  margin:0 auto;
  padding:10px;
}
header{
  text-align:center;
  margin-bottom:10px;
}
h1{
  margin:.2em 0;
  color:var(--teal);
  font-size:1.6em;
}
h2{
  margin:.4em 0 .2em;
  font-size:1.1em;
  color:#444;
}
small{
  color:#666;
}
.controls{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  margin-bottom:10px;
}
.control-group{
  border:1px solid #ccc;
  border-radius:6px;
  padding:8px;
  background:#fff;
  flex:1 1 220px;
}
.control-group label{
  display:block;
  font-size:.9em;
  margin-bottom:3px;
}
.control-group input[type="text"]{
  width:100%;
  padding:4px;
  box-sizing:border-box;
}
button{
  padding:4px 8px;
  margin:2px 0;
  border-radius:4px;
  border:1px solid var(--teal);
  background:var(--teal);
  color:#fff;
  font-size:.85em;
}
button.secondary{
  background:#fff;
  color:var(--teal);
}
button.small{
  font-size:.75em;
  padding:3px 6px;
}
.grid-container{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
}
.grid-wrapper{
  border:1px solid #ccc;
  border-radius:6px;
  padding:6px;
  background:#fff;
}
#gridTable{
  border-collapse:collapse;
  margin:auto;
}
#gridTable td{
  width:22px;
  height:22px;
  border:1px solid var(--gray);
  padding:0;
  text-align:center;
  vertical-align:middle;
  font-size:10px;
  position:relative;
  background:#fff;
}
#gridTable td.block{
  background:var(--gold);
}
#gridTable td .num{
  position:absolute;
  top:1px;
  left:2px;
  font-size:8px;
  color:#222;
}
#gridTable td span.cellIndex{
  display:none;
}
.clue-area{
  flex:1 1 260px;
}
textarea{
  width:100%;
  min-height:120px;
  box-sizing:border-box;
  font-size:.85em;
  font-family:monospace;
}
#combinedClues{
  min-height:80px;
}
#output{
  width:100%;
  min-height:180px;
  font-family:monospace;
  font-size:.8em;
  box-sizing:border-box;
}
.note{
  font-size:.8em;
  color:#555;
  margin-top:4px;
}
.rowcol-tools{
  display:flex;
  flex-wrap:wrap;
  gap:4px;
  align-items:center;
  font-size:.8em;
}
.rowcol-tools select{
  font-size:.8em;
  padding:2px;
}
@media(max-width:700px){
  #gridTable td{
    width:18px;
    height:18px;
  }
}
</style>
</head>
<body>
<div class="wrapper">
  <header>
    <h1>Crossword Editor – Inbox Puzzles</h1>
    <small>15×15 layout • tap or drag to toggle blocks • export JSON for puzzle & solution pages</small>
  </header>

  <div class="controls">
    <div class="control-group">
      <label>Title</label>
      <input type="text" id="titleInput" value="Daily Crossword">
      <label>Subtitle</label>
      <input type="text" id="subtitleInput" value="">
      <div class="note">
        These appear at the top of the puzzle and solution pages.
      </div>
    </div>

    <div class="control-group">
      <label>Grid tools</label>
      <button id="clearGridBtn" class="small secondary">Clear all (white)</button>
      <button id="fillBlocksBtn" class="small secondary">Fill all (blocks)</button>
      <div class="rowcol-tools" style="margin-top:6px;">
        <span>Row:</span>
        <select id="rowSelect"></select>
        <button id="rowFillBtn" class="small secondary">Fill</button>
        <button id="rowClearBtn" class="small secondary">Clear</button>
        <button id="rowInvertBtn" class="small secondary">Invert</button>
      </div>
      <div class="rowcol-tools" style="margin-top:4px;">
        <span>Col:</span>
        <select id="colSelect"></select>
        <button id="colFillBtn" class="small secondary">Fill</button>
        <button id="colClearBtn" class="small secondary">Clear</button>
        <button id="colInvertBtn" class="small secondary">Invert</button>
      </div>
      <div class="note">
        Tap a cell to toggle block/white. Drag to paint.
      </div>
    </div>

    <div class="control-group">
      <label>Numbering & clues</label>
      <button id="autoNumberBtn" class="small">Auto-number grid</button>
      <button id="genSkeletonBtn" class="small secondary">Generate clue skeletons</button>
      <div class="note">
        Auto-number follows standard crossword rules. Skeletons fill the clue boxes with "3. ", "4. ", etc.
      </div>
    </div>

    <div class="control-group">
      <label>Export</label>
      <button id="exportPuzzleBtn">Export Puzzle JSON</button>
      <button id="exportWithSolutionBtn" class="secondary">Export Puzzle + Blank Solution Template</button>
      <div class="note">
        Both exports include a blank <code>"solution"</code> array matching the grid. You can fill letters later in GitHub.
      </div>
    </div>
  </div>

  <div class="grid-container">
    <div class="grid-wrapper">
      <h2>Grid (15×15)</h2>
      <table id="gridTable"></table>
    </div>

    <div class="clue-area">
      <h2>Across clues</h2>
      <textarea id="acrossText" placeholder="3. Light switch locale&#10;4. Handle on a door"></textarea>

      <h2>Down clues</h2>
      <textarea id="downText" placeholder="1. Cozy TV companion&#10;2. Not dirty&#10;4. Where the cook stirs things up&#10;5. Bedroom furniture for rest"></textarea>
    </div>
  </div>

  <h2>Optional: Paste combined clues to auto-separate</h2>
  <textarea id="combinedClues" placeholder="Across&#10;3. Light switch locale&#10;4. Handle on a door&#10;&#10;Down&#10;1. Cozy TV companion&#10;2. Not dirty&#10;4. Where the cook stirs things up&#10;5. Bedroom furniture for rest"></textarea>
  <button id="parseCluesBtn" class="small secondary">Parse combined clues → Across / Down</button>
  <div class="note">
    Lines starting with a number and a dot (e.g. <code>3.</code>) will be assigned to the current section (Across or Down).
  </div>

  <h2>Exported JSON</h2>
  <textarea id="output" readonly></textarea>
  <div class="note">
    Copy this JSON into <code>puzzle.json</code> in your puzzle folder. Your puzzle and solution pages will pick it up automatically.
  </div>
</div>

<script>
const ROWS = 15;
const COLS = 15;

let grid = [];      // true = block, false = white
let numbers = [];   // integers or 0

function initData(){
  grid = [];
  numbers = [];
  for(let r=0;r<ROWS;r++){
    const rowG = [];
    const rowN = [];
    for(let c=0;c<COLS;c++){
      rowG.push(true);   // start full of blocks
      rowN.push(0);
    }
    grid.push(rowG);
    numbers.push(rowN);
  }
}

function renderGrid(){
  const table = document.getElementById('gridTable');
  table.innerHTML = '';
  for(let r=0;r<ROWS;r++){
    const tr = document.createElement('tr');
    for(let c=0;c<COLS;c++){
      const td = document.createElement('td');
      td.dataset.row = r;
      td.dataset.col = c;
      if(grid[r][c]){
        td.classList.add('block');
      }
      const numVal = numbers[r][c];
      if(numVal){
        const numDiv = document.createElement('div');
        numDiv.className = 'num';
        numDiv.textContent = numVal;
        td.appendChild(numDiv);
      }
      tr.appendChild(td);
    }
    table.appendChild(tr);
  }
  attachCellEvents();
}

let painting = false;
let paintToBlock = null;

function attachCellEvents(){
  const table = document.getElementById('gridTable');
  const cells = table.querySelectorAll('td');

  cells.forEach(td => {
    td.onpointerdown = (e)=>{
      e.preventDefault();
      const r = parseInt(td.dataset.row,10);
      const c = parseInt(td.dataset.col,10);
      painting = true;
      paintToBlock = !grid[r][c]; // flip from current state
      applyPaint(td, r, c);
    };
    td.onpointerenter = (e)=>{
      if(!painting) return;
      e.preventDefault();
      const r = parseInt(td.dataset.row,10);
      const c = parseInt(td.dataset.col,10);
      applyPaint(td, r, c);
    };
  });

  document.onpointerup = ()=>{
    painting = false;
    paintToBlock = null;
  };
}

function applyPaint(td, r, c){
  grid[r][c] = paintToBlock;
  if(grid[r][c]){
    td.classList.add('block');
  }else{
    td.classList.remove('block');
  }
  // remove number if turning into block
  if(grid[r][c]){
    numbers[r][c] = 0;
  }
}

function clearGrid(){
  for(let r=0;r<ROWS;r++){
    for(let c=0;c<COLS;c++){
      grid[r][c] = false;
      numbers[r][c] = 0;
    }
  }
  renderGrid();
}

function fillBlocks(){
  for(let r=0;r<ROWS;r++){
    for(let c=0;c<COLS;c++){
      grid[r][c] = true;
      numbers[r][c] = 0;
    }
  }
  renderGrid();
}

function rowOp(rowIndex, mode){
  for(let c=0;c<COLS;c++){
    if(mode==='fill') grid[rowIndex][c]=true;
    else if(mode==='clear') grid[rowIndex][c]=false;
    else if(mode==='invert') grid[rowIndex][c]=!grid[rowIndex][c];
    if(grid[rowIndex][c]) numbers[rowIndex][c]=0;
  }
  renderGrid();
}

function colOp(colIndex, mode){
  for(let r=0;r<ROWS;r++){
    if(mode==='fill') grid[r][colIndex]=true;
    else if(mode==='clear') grid[r][colIndex]=false;
    else if(mode==='invert') grid[r][colIndex]=!grid[r][colIndex];
    if(grid[r][colIndex]) numbers[r][colIndex]=0;
  }
  renderGrid();
}

function autoNumber(){
  // standard crossword numbering
  // reset numbers first
  for(let r=0;r<ROWS;r++){
    for(let c=0;c<COLS;c++){
      numbers[r][c]=0;
    }
  }
  let current = 1;
  for(let r=0;r<ROWS;r++){
    for(let c=0;c<COLS;c++){
      if(grid[r][c]) continue; // block
      const aboveBlock = (r===0) || grid[r-1][c];
      const leftBlock  = (c===0) || grid[r][c-1];
      if(aboveBlock || leftBlock){
        numbers[r][c] = current++;
      }
    }
  }
  renderGrid();
}

function generateClueSkeletons(){
  // build lists of across + down starts based on numbers
  const acrossNums = [];
  const downNums = [];
  for(let r=0;r<ROWS;r++){
    for(let c=0;c<COLS;c++){
      if(grid[r][c]) continue;
      const num = numbers[r][c];
      if(!num) continue;
      const isStartAcross = (c===0 || grid[r][c-1]===true) && (c+1<COLS && grid[r][c+1]===false);
      const isStartDown   = (r===0 || grid[r-1][c]===true) && (r+1<ROWS && grid[r+1][c]===false);
      if(isStartAcross) acrossNums.push(num);
      if(isStartDown) downNums.push(num);
    }
  }
  const acrossBox = document.getElementById('acrossText');
  const downBox = document.getElementById('downText');
  acrossBox.value = acrossNums.map(n=>`${n}. `).join('\n');
  downBox.value = downNums.map(n=>`${n}. `).join('\n');
}

function parseCombinedClues(){
  const raw = document.getElementById('combinedClues').value;
  const lines = raw.split(/\r?\n/);
  let section = null; // 'across' or 'down'
  const acrossLines = [];
  const downLines = [];
  for(let line of lines){
    const trimmed = line.trim();
    if(!trimmed) continue;
    const lower = trimmed.toLowerCase();
    if(lower==='across'){
      section = 'across';
      continue;
    }
    if(lower==='down'){
      section = 'down';
      continue;
    }
    const m = trimmed.match(/^(\d+)\.\s*(.*)$/);
    if(m && section){
      if(section==='across') acrossLines.push(trimmed);
      else if(section==='down') downLines.push(trimmed);
    }
  }
  document.getElementById('acrossText').value = acrossLines.join('\n');
  document.getElementById('downText').value = downLines.join('\n');
}

function buildClueObjects(){
  const acrossObj = {};
  const downObj = {};
  const acrossText = document.getElementById('acrossText').value.split(/\r?\n/);
  const downText = document.getElementById('downText').value.split(/\r?\n/);

  for(let line of acrossText){
    const trimmed = line.trim();
    if(!trimmed) continue;
    const m = trimmed.match(/^(\d+)\.\s*(.*)$/);
    if(m){
      const num = m[1];
      const clue = m[2] || '';
      acrossObj[num] = clue;
    }
  }

  for(let line of downText){
    const trimmed = line.trim();
    if(!trimmed) continue;
    const m = trimmed.match(/^(\d+)\.\s*(.*)$/);
    if(m){
      const num = m[1];
      const clue = m[2] || '';
      downObj[num] = clue;
    }
  }
  return { acrossObj, downObj };
}

function exportJson(includeSolutionTemplate){
  const title = document.getElementById('titleInput').value || 'Daily Crossword';
  const subtitle = document.getElementById('subtitleInput').value || '';

  const {acrossObj, downObj} = buildClueObjects();

  // build grid chars
  const gridChars = [];
  for(let r=0;r<ROWS;r++){
    const row = [];
    for(let c=0;c<COLS;c++){
      row.push(grid[r][c] ? "#" : "");
    }
    gridChars.push(row);
  }

  // build solution template (no letters yet)
  const solution = [];
  if(includeSolutionTemplate){
    for(let r=0;r<ROWS;r++){
      const row = [];
      for(let c=0;c<COLS;c++){
        row.push(grid[r][c] ? "#" : "");
      }
      solution.push(row);
    }
  }

  const obj = {
    title:title,
    subtitle:subtitle,
    rows:ROWS,
    cols:COLS,
    grid:gridChars,
    numbers:numbers,
    across:acrossObj,
    down:downObj
  };
  if(includeSolutionTemplate){
    obj.solution = solution;
  }

  const out = JSON.stringify(obj,null,2);
  document.getElementById('output').value = out;
}

// INITIALIZE
(function(){
  initData();
  const rowSel = document.getElementById('rowSelect');
  const colSel = document.getElementById('colSelect');
  for(let i=1;i<=ROWS;i++){
    const o = document.createElement('option');
    o.value = i-1;
    o.textContent = i;
    rowSel.appendChild(o);
  }
  for(let i=1;i<=COLS;i++){
    const o = document.createElement('option');
    o.value = i-1;
    o.textContent = i;
    colSel.appendChild(o);
  }
  renderGrid();

  document.getElementById('clearGridBtn').onclick = clearGrid;
  document.getElementById('fillBlocksBtn').onclick = fillBlocks;
  document.getElementById('rowFillBtn').onclick = ()=>rowOp(parseInt(rowSel.value,10),'fill');
  document.getElementById('rowClearBtn').onclick = ()=>rowOp(parseInt(rowSel.value,10),'clear');
  document.getElementById('rowInvertBtn').onclick = ()=>rowOp(parseInt(rowSel.value,10),'invert');
  document.getElementById('colFillBtn').onclick = ()=>colOp(parseInt(colSel.value,10),'fill');
  document.getElementById('colClearBtn').onclick = ()=>colOp(parseInt(colSel.value,10),'clear');
  document.getElementById('colInvertBtn').onclick = ()=>colOp(parseInt(colSel.value,10),'invert');
  document.getElementById('autoNumberBtn').onclick = autoNumber;
  document.getElementById('genSkeletonBtn').onclick = generateClueSkeletons;
  document.getElementById('parseCluesBtn').onclick = parseCombinedClues;
  document.getElementById('exportPuzzleBtn').onclick = ()=>exportJson(true);
  document.getElementById('exportWithSolutionBtn').onclick = ()=>exportJson(true);
})();
</script>
</body>
</html>
